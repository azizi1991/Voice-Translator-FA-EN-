<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>مترجم ویس فارسی به انگلیسی</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <style>
    body {
      font-family: 'Vazirmatn', Tahoma, Arial, sans-serif;
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      margin: 0;
      padding: 0;
      direction: rtl;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }

    .container {
      background: #fff;
      border-radius: 22px;
      box-shadow: 0 12px 48px rgba(0, 0, 0, 0.2);
      width: 92%;
      max-width: 460px;
      padding: 36px 28px 32px;
      animation: fadein 1.2s ease-out;
    }

    @keyframes fadein {
      from { opacity: 0; transform: translateY(50px);}
      to { opacity: 1; transform: translateY(0);}
    }

    h2 {
      color: #1e3c72;
      margin-bottom: 12px;
      font-size: 1.8rem;
      font-weight: 700;
    }

    h4 {
      color: #4f8cff;
      font-size: 1.1rem;
      margin-bottom: 24px;
      font-weight: 400;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      font-size: 16px;
      padding: 12px 28px;
      margin: 10px 0;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      font-family: inherit;
      font-weight: 500;
      width: 100%;
    }

    .btn:active {
      transform: scale(0.96);
    }

    .record {
      background: linear-gradient(90deg, #4f8cff, #00c6ff);
      color: #fff;
    }

    .record.active {
      background: linear-gradient(90deg, #e74c3c, #ff7675);
      box-shadow: 0 0 0 4px #ffd6d6;
    }

    textarea {
      width: 100%;
      height: 90px;
      margin: 20px 0 14px;
      border-radius: 10px;
      border: 1.5px solid #dbeafe;
      padding: 14px;
      background: #f7fbff;
      resize: none;
      font-size: 16px;
      font-family: inherit;
    }

    textarea:focus {
      border-color: #4f8cff;
      outline: none;
    }

    .hint {
      font-size: 14px;
      color: #888;
      margin-top: 6px;
    }

    #result {
      margin-top: 24px;
      font-size: 18px;
      color: #2d3a4b;
      min-height: 36px;
      font-weight: 500;
      line-height: 1.5;
      white-space: pre-wrap;
    }

    .mic-anim {
      display: inline-block;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }

    @media (max-width: 480px) {
      h2 { font-size: 1.5rem; }
      h4 { font-size: 1rem; }
      .btn { font-size: 15px; padding: 10px 22px; }
    }
    #faText {
  width: 100%;
  max-width: 100%;
  height: 120px;
  margin: 22px 0 12px 0;
  font-size: 17px;
  border-radius: 10px;
  border: 1.5px solid #dbeafe;
  padding: 12px;
  background: #f7fbff;
  resize: vertical;
  transition: border 0.2s, box-shadow 0.2s;
  font-family: inherit;
  font-weight: 400;
  box-sizing: border-box;
}
#faText:focus {
  border: 1.5px solid #4f8cff;
  box-shadow: 0 0 4px rgba(79, 140, 255, 0.4);
  outline: none;
}

  </style>
</head>
<body>
  <div class="container">
    <h2>مترجم ویس فارسی به انگلیسی</h2>
    <h4>Voice Translator (FA → EN)</h4>
    
    <button id="recordBtn" class="btn record">
      <i id="micIcon" class="fas fa-microphone"></i> شروع ضبط و ترجمه
    </button>
    
    <div class="hint">برای شروع ضبط، دکمه بالا را فشار دهید.</div>
    
    <textarea id="faText" placeholder="متن تشخیص داده‌شده در اینجا نمایش داده می‌شود..."></textarea>
    
    <div id="result"></div>
  </div>

<script>
  let recognition;
  let isRecording = false;

  const recordBtn = document.getElementById('recordBtn');
  const faText = document.getElementById('faText');
  const resultDiv = document.getElementById('result');
  const micIcon = document.getElementById('micIcon');

  async function translateAndCopy(text) {
    if (!text.trim()) {
      resultDiv.innerText = "متنی برای ترجمه وارد نشده است.";
      return;
    }
    resultDiv.innerText = "در حال ترجمه...";
    try {
      const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=fa&tl=en&dt=t&q=${encodeURIComponent(text)}`);
      const data = await res.json();
      const translated = data[0][0][0];
      resultDiv.innerText = translated;

      try {
        await navigator.clipboard.writeText(translated);
        resultDiv.innerText += "\n(ترجمه کپی شد)";
      } catch {
        resultDiv.innerText += "\n(کپی نشد)";
      }
    } catch {
      resultDiv.innerText = "خطا در ترجمه!";
    }
  }

  if (!('webkitSpeechRecognition' in window)) {
    recordBtn.disabled = true;
    resultDiv.innerText = "مرورگر شما از تبدیل گفتار به متن پشتیبانی نمی‌کند.";
  } else {
    recognition = new webkitSpeechRecognition();
    recognition.lang = "fa-IR";
    recognition.continuous = true;
    recognition.interimResults = false;

    recognition.onstart = () => {
      faText.value = "";
      resultDiv.innerHTML = `<span class="mic-anim">🎤 در حال گوش دادن...</span>`;
      recordBtn.classList.add("active");
      micIcon.className = "fas fa-stop";
      recordBtn.innerHTML = `<i id="micIcon" class="fas fa-stop"></i> توقف ضبط`;
    };

    recognition.onresult = (event) => {
      let finalTranscript = "";
      for (let i = event.resultIndex; i < event.results.length; ++i) {
        if (event.results[i].isFinal) {
          finalTranscript += event.results[i][0].transcript;
        }
      }
      faText.value = finalTranscript;
      translateAndCopy(finalTranscript);
    };

    recognition.onerror = (event) => {
      resultDiv.innerText = "خطا در تشخیص صدا: " + event.error;
      resetButton();
    };

    recognition.onend = () => {
      isRecording = false;
      resetButton();
    };
  }

  recordBtn.onclick = () => {
    if (!isRecording) {
      recognition.start();
      isRecording = true;
    } else {
      recognition.stop();
      isRecording = false;
    }
  };

  function resetButton() {
    recordBtn.classList.remove("active");
    micIcon.className = "fas fa-microphone";
    recordBtn.innerHTML = `<i id="micIcon" class="fas fa-microphone"></i> شروع ضبط و ترجمه`;
  }

  faText.addEventListener("input", () => {
    translateAndCopy(faText.value);
  });
</script>
</body>
</html>
